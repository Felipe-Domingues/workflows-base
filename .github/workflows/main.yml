name: Deploy Staging → Produção

on:
  push:
    branches:
      - staging

jobs:
  deploy-em-staging:
    name: Deploy em Staging
    runs-on: ubuntu-latest
    steps:
      - name: Verificar se o workflow de staging existe
        run: |
          WORKFLOW_EXISTS=$(gh workflow list --repo felipe-domingues/workflows-base | grep "staging.yml" || true)
          if [ -z "$WORKFLOW_EXISTS" ]; then
            echo "❌ O workflow 'staging.yml' não foi encontrado. Pular para o próximo job."
            exit 1
          else
            echo "✅ Workflow 'staging.yml' encontrado."
          fi

      - name: Executar workflow de staging
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          gh workflow run felipe-domingues/workflows-base/.github/workflows/staging.yml@main

  deploy-em-producao:
    name: Deploy em Produção
    runs-on: ubuntu-latest
    steps:
      - name: Verificar se o workflow de produção existe
        run: |
          WORKFLOW_EXISTS=$(gh workflow list --repo felipe-domingues/workflows-base | grep "production.yml" || true)
          if [ -z "$WORKFLOW_EXISTS" ]; then
            echo "❌ O workflow 'production.yml' não foi encontrado."
            exit 1
          else
            echo "✅ Workflow 'production.yml' encontrado."
          fi

      - name: Executar workflow de produção
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          gh workflow run felipe-domingues/workflows-base/.github/workflows/production.yml@main
