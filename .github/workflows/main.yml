name: üöÄ Deploy Staging ‚Üí Produ√ß√£o

on:
  workflow_call:

jobs:
  validate-workflow-staging:
    name: üîç Validando workflow de staging
    runs-on: ubuntu-latest
    outputs:
      workflow_exists: ${{ steps.check_workflow_staging.outputs.exists }}
    steps:
      - name: üì• Verificando se o workflow staging.yml existe
        id: check_workflow_staging
        run: |
          WORKFLOW_EXISTS=$(gh workflow list --repo felipe-domingues/workflows-base | grep "staging.yml" || true)
          if [ -z "$WORKFLOW_EXISTS" ]; then
            echo "‚ùå O workflow 'staging.yml' n√£o foi encontrado. Pular para o pr√≥ximo job."
            echo "::set-output name=exists::false"
          else
            echo "‚úÖ Workflow 'staging.yml' encontrado."
            echo "::set-output name=exists::true"
          fi

  deploy-em-staging:
    name: üß™ Deploy em Staging
    runs-on: ubuntu-latest
    needs: validate-workflow-staging
    if: needs.validate-workflow-staging.outputs.workflow_exists == 'true'
    steps:
      - name: ‚ñ∂Ô∏è Executando workflow de staging no reposit√≥rio ${{ github.repository }}
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          echo -e "\033[1;34müîÅ Disparando workflow 'staging.yml' no reposit√≥rio felipe-domingues/workflows-base...\033[0m"
          gh workflow run staging.yml --repo felipe-domingues/workflows-base

  validate-workflow-production:
    name: üîç Validando workflow de produ√ß√£o
    runs-on: ubuntu-latest
    outputs:
      workflow_exists: ${{ steps.check_workflow_production.outputs.exists }}
    steps:
      - name: üì• Verificando se o workflow production.yml existe
        id: check_workflow_production
        run: |
          WORKFLOW_EXISTS=$(gh workflow list --repo felipe-domingues/workflows-base | grep "production.yml" || true)
          if [ -z "$WORKFLOW_EXISTS" ]; then
            echo "‚ùå O workflow 'production.yml' n√£o foi encontrado. Pular para o pr√≥ximo job."
            echo "::set-output name=exists::false"
          else
            echo "‚úÖ Workflow 'production.yml' encontrado."
            echo "::set-output name=exists::true"
          fi

  deploy-em-producao:
    name: üö¢ Deploy em Produ√ß√£o
    runs-on: ubuntu-latest
    needs: validate-workflow-production
    if: needs.validate-workflow-production.outputs.workflow_exists == 'true'
    steps:
      - name: ‚ñ∂Ô∏è Executando workflow de produ√ß√£o no reposit√≥rio ${{ github.repository }}
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          echo -e "\033[1;34müì¶ Disparando workflow 'production.yml' no reposit√≥rio felipe-domingues/workflows-base...\033[0m"
          gh workflow run production.yml --repo felipe-domingues/workflows-base
